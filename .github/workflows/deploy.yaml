# ワークフローの名前
name: Deploy to GitHub Pages

# ワークフローが実行されるタイミングを定義
on:
  # mainブランチにプッシュされた時
  push:
    branches: [ main ]
  # GitHubのActionsタブから手動で実行できるようにする
  workflow_dispatch:

# ジョブ（一連の処理）を定義
jobs:
  # ビルドとデプロイを行うジョブ
  build-and-deploy:
    # 最新のUbuntu環境で実行
    runs-on: ubuntu-latest
    
    permissions:
      contents: write

    # ジョブ内のステップを定義
    steps:
      # 1. リポジトリのコードをチェックアウトする
      - name: Checkout
        uses: actions/checkout@v4

      # 2. Rustの安定版ツールチェインをセットアップする
      - name: Setup Rust toolchain
        uses: dtolnay/rust-toolchain@stable

      # 3. wasm-packをインストールする
      - name: Install wasm-pack
        run: cargo install wasm-pack

      # 4. RustコードをWASMにビルドする（出力先は static/pkg）
      #    このステップで、Webページに必要な全ファイルが `static` ディレクトリに揃う
      - name: Build WASM
        run: wasm-pack build --target web --out-dir static/pkg

      # NEW STEP HERE
      - name: List static directory contents
        run: |
          echo "Listing contents of ./static:"
          ls -R static
          echo "Current working directory:"
          pwd

      # Create .nojekyll file
      - name: Create .nojekyll file
        run: touch static/.nojekyll

      # 5. `static` ディレクトリの内容を `gh-pages` ブランチにデプロイする
      #    Deploy action changed to JamesIves
      - name: Deploy to GitHub Pages
        uses: JamesIves/github-pages-deploy-action@v4.6.0
        with:
          branch: gh-pages # The branch the action should deploy to.
          folder: static   # The folder the action should deploy.
          token: ${{ secrets.GITHUB_TOKEN }}
